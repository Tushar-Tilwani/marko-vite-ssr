{
  "version": 3,
  "sources": ["../../marko/src/runtime/components/event-delegation.js"],
  "sourcesContent": ["var componentsUtil = require(\"@internal/components-util\");\nvar runtimeId = componentsUtil.___runtimeId;\nvar componentLookup = componentsUtil.___componentLookup;\nvar getMarkoPropsFromEl = componentsUtil.___getMarkoPropsFromEl;\n\nvar TEXT_NODE = 3;\n\n// We make our best effort to allow multiple marko runtimes to be loaded in the\n// same window. Each marko runtime will get its own unique runtime ID.\nvar listenersAttachedKey = \"$MDE\" + runtimeId;\nvar delegatedEvents = {};\n\nfunction getEventFromEl(el, eventName) {\n  var virtualProps = getMarkoPropsFromEl(el);\n  var eventInfo = virtualProps[eventName];\n\n  if (typeof eventInfo === \"string\") {\n    eventInfo = eventInfo.split(\" \");\n    if (eventInfo[2]) {\n      eventInfo[2] = eventInfo[2] === \"true\";\n    }\n    if (eventInfo.length == 4) {\n      eventInfo[3] = parseInt(eventInfo[3], 10);\n    }\n  }\n\n  return eventInfo;\n}\n\nfunction delegateEvent(node, eventName, target, event) {\n  var targetMethod = target[0];\n  var targetComponentId = target[1];\n  var isOnce = target[2];\n  var extraArgs = target[3];\n\n  if (isOnce) {\n    var virtualProps = getMarkoPropsFromEl(node);\n    delete virtualProps[eventName];\n  }\n\n  var targetComponent = componentLookup[targetComponentId];\n\n  if (!targetComponent) {\n    return;\n  }\n\n  var targetFunc =\n    typeof targetMethod === \"function\"\n      ? targetMethod\n      : targetComponent[targetMethod];\n  if (!targetFunc) {\n    throw Error(\"Method not found: \" + targetMethod);\n  }\n\n  if (extraArgs != null) {\n    if (typeof extraArgs === \"number\") {\n      extraArgs = targetComponent.___bubblingDomEvents[extraArgs];\n    }\n  }\n\n  // Invoke the component method\n  if (extraArgs) {\n    targetFunc.apply(targetComponent, extraArgs.concat(event, node));\n  } else {\n    targetFunc.call(targetComponent, event, node);\n  }\n}\n\nfunction addDelegatedEventHandler(eventType) {\n  if (!delegatedEvents[eventType]) {\n    delegatedEvents[eventType] = true;\n  }\n}\n\nfunction addDelegatedEventHandlerToHost(eventType, host) {\n  var listeners = (host[listenersAttachedKey] =\n    host[listenersAttachedKey] || {});\n  if (!listeners[eventType]) {\n    (host.body || host).addEventListener(\n      eventType,\n      (listeners[eventType] = function (event) {\n        var curNode = event.target;\n        if (!curNode) {\n          return;\n        }\n\n        curNode =\n          // event.target of an SVGElementInstance does not have a\n          // `getAttribute` function in IE 11.\n          // See https://github.com/marko-js/marko/issues/796\n          curNode.correspondingUseElement ||\n          // in some browsers the event target can be a text node\n          // one example being dragenter in firefox.\n          (curNode.nodeType === TEXT_NODE ? curNode.parentNode : curNode);\n\n        // Search up the tree looking DOM events mapped to target\n        // component methods\n        var propName = \"on\" + eventType;\n        var target;\n\n        // Attributes will have the following form:\n        // on<event_type>(\"<target_method>|<component_id>\")\n\n        if (event.bubbles) {\n          var propagationStopped = false;\n\n          // Monkey-patch to fix #97\n          var oldStopPropagation = event.stopPropagation;\n\n          event.stopPropagation = function () {\n            oldStopPropagation.call(event);\n            propagationStopped = true;\n          };\n\n          do {\n            if ((target = getEventFromEl(curNode, propName))) {\n              delegateEvent(curNode, propName, target, event);\n\n              if (propagationStopped) {\n                break;\n              }\n            }\n          } while ((curNode = curNode.parentNode) && curNode.getAttribute);\n        } else if ((target = getEventFromEl(curNode, propName))) {\n          delegateEvent(curNode, propName, target, event);\n        }\n      }),\n      true,\n    );\n  }\n}\n\nfunction noop() {}\n\nexports.___handleNodeAttach = noop;\nexports.___handleNodeDetach = noop;\nexports.___delegateEvent = delegateEvent;\nexports.___getEventFromEl = getEventFromEl;\nexports.___addDelegatedEventHandler = addDelegatedEventHandler;\nexports.___init = function (host) {\n  Object.keys(delegatedEvents).forEach(function (eventType) {\n    addDelegatedEventHandlerToHost(eventType, host);\n  });\n};\n"],
  "mappings": "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",
  "names": []
}
