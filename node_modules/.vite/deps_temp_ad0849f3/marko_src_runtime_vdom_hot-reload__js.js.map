{
  "version": 3,
  "sources": ["../../marko/src/runtime/vdom/hot-reload.js"],
  "sourcesContent": ["var registry = require(\"@internal/components-registry\");\nvar setImmediate = require(\"@internal/set-immediate\").___setImmediate;\nvar updateManager = require(\"../components/update-manager\");\nvar runtime = require(\".\");\n\nvar createTemplate = runtime.t;\nvar createComponent = registry.___createComponent;\nvar registered = {};\nvar instancesByType = {};\nvar queue;\n\nexports.t = runtime.t = function (typeName) {\n  if (registered[typeName]) {\n    return registered[typeName];\n  }\n\n  var renderFn;\n  var template = (registered[typeName] = createTemplate(typeName));\n  var instances = (instancesByType[typeName] = new Set());\n  Object.defineProperty(template, \"_\", {\n    get: function () {\n      return renderFn && proxyRenderer;\n    },\n    set: function (v) {\n      renderFn = v;\n\n      if (instances.size) {\n        if (!queue) {\n          queue = [];\n          setImmediate(batchUpdate);\n        }\n\n        queue.push(function () {\n          var newProto = registry.___getComponentClass(typeName).prototype;\n          instances.forEach(function (instance) {\n            if (hasLifecycleChanged(instance.__proto__, newProto)) {\n              var renderer = instance.___renderer;\n              instance.___renderer = (input, out) => {\n                instance.___emitCreate(input, out);\n                if (instance.onInput) {\n                  input = instance.onInput(input, out) || input;\n                }\n                instance.___renderer = renderer;\n                instance.___renderer(input, out);\n              };\n\n              instance.___hmrDestroyed = true;\n              instance.___emitDestroy();\n              instance.___mounted = false;\n\n              if (instance.___subscriptions) {\n                instance.___subscriptions.removeAllListeners();\n                instance.___subscriptions = null;\n              }\n            }\n\n            instance.__proto__ = newProto;\n            instance\n              .___rerender(instance.___input, false)\n              .afterInsert(instance.___host);\n          });\n        });\n      }\n    },\n  });\n\n  return template;\n\n  function proxyRenderer() {\n    return renderFn.apply(this, arguments);\n  }\n};\n\nregistry.___createComponent = function (typeName, id) {\n  var instances = instancesByType[typeName];\n  var instance = createComponent(typeName, id);\n\n  if (instances) {\n    instances.add(instance);\n    instance.once(\"destroy\", function () {\n      if (!instance.___hmrDestroyed) {\n        instances.delete(instance);\n      }\n    });\n  }\n\n  return instance;\n};\n\nfunction hasLifecycleChanged(oldProto, newProto) {\n  return (\n    hasMethodChanged(\"onCreate\") ||\n    hasMethodChanged(\"onInput\") ||\n    hasMethodChanged(\"onRender\") ||\n    hasMethodChanged(\"onMount\")\n  );\n\n  function hasMethodChanged(method) {\n    return (\n      (oldProto[method] && oldProto[method].toString()) !==\n      (newProto[method] && newProto[method].toString())\n    );\n  }\n}\n\nfunction batchUpdate() {\n  updateManager.___batchUpdate(function () {\n    var pending = queue;\n    queue = undefined;\n\n    for (var i = 0; i < pending.length; i++) {\n      pending[i]();\n    }\n  });\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA,QAAI,WAAW;AACf,QAAI,eAAe,wBAAmC;AACtD,QAAI,gBAAgB;AACpB,QAAI,UAAU;AAEd,QAAI,iBAAiB,QAAQ;AAC7B,QAAI,kBAAkB,SAAS;AAC/B,QAAI,aAAa,CAAC;AAClB,QAAI,kBAAkB,CAAC;AACvB,QAAI;AAEJ,YAAQ,IAAI,QAAQ,IAAI,SAAU,UAAU;AAC1C,UAAI,WAAW,QAAQ,GAAG;AACxB,eAAO,WAAW,QAAQ;AAAA,MAC5B;AAEA,UAAI;AACJ,UAAI,WAAY,WAAW,QAAQ,IAAI,eAAe,QAAQ;AAC9D,UAAI,YAAa,gBAAgB,QAAQ,IAAI,oBAAI,IAAI;AACrD,aAAO,eAAe,UAAU,KAAK;AAAA,QACnC,KAAK,WAAY;AACf,iBAAO,YAAY;AAAA,QACrB;AAAA,QACA,KAAK,SAAU,GAAG;AAChB,qBAAW;AAEX,cAAI,UAAU,MAAM;AAClB,gBAAI,CAAC,OAAO;AACV,sBAAQ,CAAC;AACT,2BAAa,WAAW;AAAA,YAC1B;AAEA,kBAAM,KAAK,WAAY;AACrB,kBAAI,WAAW,SAAS,qBAAqB,QAAQ,EAAE;AACvD,wBAAU,QAAQ,SAAU,UAAU;AACpC,oBAAI,oBAAoB,SAAS,WAAW,QAAQ,GAAG;AACrD,sBAAI,WAAW,SAAS;AACxB,2BAAS,cAAc,CAAC,OAAO,QAAQ;AACrC,6BAAS,cAAc,OAAO,GAAG;AACjC,wBAAI,SAAS,SAAS;AACpB,8BAAQ,SAAS,QAAQ,OAAO,GAAG,KAAK;AAAA,oBAC1C;AACA,6BAAS,cAAc;AACvB,6BAAS,YAAY,OAAO,GAAG;AAAA,kBACjC;AAEA,2BAAS,kBAAkB;AAC3B,2BAAS,eAAe;AACxB,2BAAS,aAAa;AAEtB,sBAAI,SAAS,kBAAkB;AAC7B,6BAAS,iBAAiB,mBAAmB;AAC7C,6BAAS,mBAAmB;AAAA,kBAC9B;AAAA,gBACF;AAEA,yBAAS,YAAY;AACrB,yBACG,YAAY,SAAS,UAAU,KAAK,EACpC,YAAY,SAAS,OAAO;AAAA,cACjC,CAAC;AAAA,YACH,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF,CAAC;AAED,aAAO;AAEP,eAAS,gBAAgB;AACvB,eAAO,SAAS,MAAM,MAAM,SAAS;AAAA,MACvC;AAAA,IACF;AAEA,aAAS,qBAAqB,SAAU,UAAU,IAAI;AACpD,UAAI,YAAY,gBAAgB,QAAQ;AACxC,UAAI,WAAW,gBAAgB,UAAU,EAAE;AAE3C,UAAI,WAAW;AACb,kBAAU,IAAI,QAAQ;AACtB,iBAAS,KAAK,WAAW,WAAY;AACnC,cAAI,CAAC,SAAS,iBAAiB;AAC7B,sBAAU,OAAO,QAAQ;AAAA,UAC3B;AAAA,QACF,CAAC;AAAA,MACH;AAEA,aAAO;AAAA,IACT;AAEA,aAAS,oBAAoB,UAAU,UAAU;AAC/C,aACE,iBAAiB,UAAU,KAC3B,iBAAiB,SAAS,KAC1B,iBAAiB,UAAU,KAC3B,iBAAiB,SAAS;AAG5B,eAAS,iBAAiB,QAAQ;AAChC,gBACG,SAAS,MAAM,KAAK,SAAS,MAAM,EAAE,SAAS,QAC9C,SAAS,MAAM,KAAK,SAAS,MAAM,EAAE,SAAS;AAAA,MAEnD;AAAA,IACF;AAEA,aAAS,cAAc;AACrB,oBAAc,eAAe,WAAY;AACvC,YAAI,UAAU;AACd,gBAAQ;AAER,iBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACvC,kBAAQ,CAAC,EAAE;AAAA,QACb;AAAA,MACF,CAAC;AAAA,IACH;AAAA;AAAA;",
  "names": []
}
